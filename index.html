<!DOCTYPE html>
<html>

<head>
  <title>Uno</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="description" content="Demo project">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Load required Bootstrap and BootstrapVue CSS -->
  <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
  <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css" />

  <!-- Load polyfills to support older browsers -->
  <script src="//polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver" crossorigin="anonymous">
  </script>

  <!-- Load Vue followed by BootstrapVue -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>

  <!-- Load the following for BootstrapVueIcons support -->
  <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue-icons.min.js"></script>

  <!-- Jquery for Bootstrap to work properly -->
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
  </script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
  </script>

  <!-- Scrolling animation for chatbox -->
  <script src="https://cdn.jsdelivr.net/npm/vue-chat-scroll/dist/vue-chat-scroll.min.js"></script>

  <!-- lo dash -->
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.min.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Nunito:600&display=swap" rel="stylesheet">
</head>

<body>

  <!-- Modal -->
  <div class="modal fade" id="clientConnexionContainer" data-backdrop="static" tabindex="-1" role="dialog"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalCenterTitle">Connexion</h5>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label class="sr-only" for="inputPseudo">Pseudo</label>
              <input type="text" class="form-control" id="inputPseudo" aria-describedby="emailHelp"
                data-toggle="tooltip" data-placement="bottom" title="Maximum 20 caractères, minimum 3."
                placeholder="Pseudo" v-model:value="pseudo">
            </div>
            <div class="form-group">
              <label class="sr-only" for="inputRoom">Room</label>
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text">#</div>
                </div>
                <input type="text" class="form-control" id="inputRoom" placeholder="Room" data-toggle="tooltip"
                  data-placement="bottom" title="Suite de 6 caractères [ 0-9 | a-Z ]." v-model:value="room">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <small class="form-text text-muted">Lorsque vous créez une room le nom est automatiquement généré.</small>
          <button type="button" class="btn btn btn-outline-success" @click="create">Créer une room</button>
          <button type="button" class="btn btn btn-success" @click="join">Rejoindre une room</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Navbar -->
  <nav id="navbar">
    <div class="nav nav-tabs mx-2 mt-2" id="nav-tab" role="tablist">
      <a class="nav-item nav-link active" data-toggle="tab" href="#nav-jeu" role="tab" aria-controls="nav-jeu"
        aria-selected="true">Jeu</a>
      <a ref="buttonChatCollapse" id="buttonChatCollapse" class="nav-item nav-link" data-toggle="tab" href="#nav-chat"
        role="tab" aria-controls="nav-chat" aria-selected="false">Chat <span class="badge badge-primary badge-pill"
          v-if="unreadMessage >= 1">{{unreadMessage}} message<span v-if="unreadMessage > 1">s</span></span></a>
      <a class="nav-item nav-link" data-toggle="tab" href="#nav-options" role="tab" aria-controls="nav-options"
        aria-selected="false" v-if="show.OptionMenu">Options</a>
      <ul class="nav navbar-nav ml-auto">
        <li v-if="show.StartButton"><button type="button" class="btn btn btn-success">
            <div class="spinner-grow spinner-grow-sm align-middle mr-1" role="status">
              <span class="sr-only">En attente du lancement de la partie</span>
            </div>Lancer la partie
          </button></li>
      </ul>
    </div>
  </nav>
  <div class="tab-content" id="nav-tabContent">


    <div class="tab-pane fade show active" id="nav-jeu" role="tabpanel" aria-labelledby="nav-home-jeu">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm">
            <div id="handList" v-if="showCards" class="fixed-bottom">
              <div class="d-flex justify-content-center align-items-center w-75 mx-auto mb-2">
                <div class="card-deck">
                  <div class="card m-0 border-0" v-for="(card, index) in orderedCardList" data-toggle="tooltip"
                    :title="card.fullName" @click="test(index)">
                    <img :src="card.imgSrc" class="card-img-top" :alt="card.fullName">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="tab-pane fade" id="nav-chat" role="tabpanel" aria-labelledby="nav-chat-tab">
      <div class="container mt-3">
        <div id="chat" class="border rounded p-3 m-auto">
          <div class="border rounded text-wrap" style="height: 50vh; width: 100%; overflow-x: hidden; overflow-y: auto;"
            v-chat-scroll="{always: false, smooth: true}">
            <ul class="list-group">
              <li class="list-group-item border-top-0 border-left-0 border-right-0 rounded-0 p-1 text-wrap"
                v-for="data in history" :class="data.style"><span
                  class="badge badge-secondary float-right badge-pill">{{data.date}}</span><span
                  v-if="data.sender != ''">
                  <div class="badge badge-dark p-1 m-0" style="font-size: 1em;">
                    {{data.sender}}
                  </div>
                </span>
                {{data.message}}
              </li>
            </ul>
          </div>
          <hr>
          <form @submit.prevent="sendMessage">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Votre message" aria-label="Recipient's username"
                aria-describedby="button-addon2" v-model:value="inputMessage">
              <div class="input-group-append">
                <button class="btn btn-primary" type="submit" id="button-addon2">Envoyer</button>
              </div>
            </div>
          </form>
        </div>
      </div>

    </div>
    <div class="tab-pane fade" id="nav-options" role="tabpanel" aria-labelledby="nav-options-tab">
      <div class="container border rounded mt-3">
        <form>
          <div class="form-group row m-2">
            <div class="col-sm-2 h5 text-center">Paramètres de la partie</div>
            <div class="col-sm-10">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="activateCheat">
                <label class="form-check-label" for="activateCheat">
                  <div class="badge badge-warning p-1" style="font-size: 1em;">Non disponible</div> Autoriser la triche
                  <p class="text-muted">
                    Autorise les joueurs à placer la carte qu'ils veulent pendant leur tour, si un joueur est suspecté
                    de triche vous pouvez faire un vote pour qu'il pioche une carte.
                  </p>
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="vocalMode">
                <label class="form-check-label" for="vocalMode">
                  <div class="badge badge-warning p-1" style="font-size: 1em;">Non disponible</div> Mode vocal
                  <p class="text-muted">
                    Lorsque le joueur est sur le point d'avoir qu'une seule carte restante il doit dire UNO, s'il oublie
                    ou qu'un contre uno a été fait un vote pourra être effectué contre lui pour qu'il tire une carte.
                  </p>
                </label>
              </div>
            </div>
          </div>
          <hr>
          <div class="form-group row m-2">
            <div class="col-sm-2 h5 text-center">Gérer les joueurs</div>
            <div class="col-sm-10">
              <div class="accordion" id="accordionExample">

                <div class="card">
                  <div class="card-header btn btn-link" id="headingOne" type="button" data-toggle="collapse"
                    data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Gérer Thyodas
                  </div>
                  <div id="collapseOne" class="collapse show" aria-labelledby="headingOne"
                    data-parent="#accordionExample">
                    <div class="card-body">
                      <button type="button" class="btn btn-danger mx-2">Kick</button><button type="button"
                        class="btn btn-outline-danger mx-2">Mute du chat</button>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
    </li>
    </ul>
  </div>
  </div>

  <style>
    body {
      font-family: 'Nunito', sans-serif !important;
    }

    * {
      height: auto;
    }

    ::-webkit-scrollbar {
      width: 9px;
      height: 9px;
    }

    ::-webkit-scrollbar-button {
      width: 0px;
      height: 0px;
    }

    ::-webkit-scrollbar-thumb {
      background: #e1e1e1;
      border: 0px none #ffffff;
      border-radius: 50px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #ffffff;
    }

    ::-webkit-scrollbar-thumb:active {
      background: #bcbcbc;
    }

    ::-webkit-scrollbar-track {
      background: #939393;
      border: 0px none #ffffff;
      border-radius: 50px;
    }

    ::-webkit-scrollbar-track:hover {
      background: #666666;
    }

    ::-webkit-scrollbar-track:active {
      background: #333333;
    }

    ::-webkit-scrollbar-corner {
      background: transparent;
    }
  </style>

  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    var socket = null;
    var chatBox = new Vue({
      el: '#chat',
      data: {
        history: [],
        inputMessage: ""
      },
      methods: {
        addMessage: function (sender, message, style) {
          let currentDate = new Date();
          let date = ("0" + currentDate.getHours()).slice(-2) + ":" + ("0" + currentDate.getMinutes()).slice(-2) +
            ":" + ("0" + currentDate.getSeconds()).slice(-2);
          this.history.push({
            "sender": sender,
            "message": message,
            "style": style,
            "date": date
          });
          navbar.addUnreadMessage();
        },
        sendMessage: function () {
          socket.emit('send-message', {
            "message": this.inputMessage
          });
          this.inputMessage = "";
        }
      }
    });

    var navbar = new Vue({
      el: "#navbar",
      data: {
        unreadMessage: 0,
        show: {
          "OptionMenu": false,
          "StartButton": false
        }
      },
      methods: {
        toggleNavElements: function (element, option) {
          this.show[element] = option;
        },
        addUnreadMessage: function () {
          if (_.includes(this.$refs.buttonChatCollapse.className, 'active')) {
            this.unreadMessage = 0;
          } else {
            this.unreadMessage += 1;
          }
        },
        resetUnread: function () {
          this.unreadMessage = 0;
        }
      }
    });

    var clientConnexion = new Vue({
      el: '#clientConnexionContainer',
      data: {
        pseudo: "Testing",
        room: ""
      },
      methods: {
        show: function () {
          $("#clientConnexionContainer").modal("show");
        },
        hide: function () {
          $("#clientConnexionContainer").modal("hide");
        },
        join: function () {
          socket.emit('join-room', {
            "pseudo": this.pseudo,
            "room": this.room
          });
        },
        create: function () {
          socket.emit('create-room', {
            "pseudo": this.pseudo
          });
        }
      },
      created: function () {
        socket = io({
          'reconnection': true,
          'reconnectionDelay': 1000,
          'reconnectionDelayMax': 5000,
          'reconnectionAttempts': 50
        });
      },
      mounted: function () {
        socket.on('show-connexion', function () {
          clientConnexion.show();
        })
        socket.on('hide-connexion', function () {
          clientConnexion.hide();
        })
      }
    });

    var handRenderCards = new Vue({
      el: '#handList',
      data: {
        cardList: [], //zeroRed, oneRed, twoRed, threeRed, fourRed, oneRed
        showCards: true
      },
      methods: {
        test: function (element) {
          console.log(element.uniqID);
        },
        setupCards: function (list) {
          this.cardList = list;
        }
      },
      computed: {
        setUniqID: function () {
          return _.forEach(this.cardList, function (element, position) {
            element.uniqID = position;
          });
        },
        orderedCardList: function () {
          return _.orderBy(this.setUniqID, 'fullName')
        }
      }
    });

    var toastNotification = new Vue({
      methods: {
        newToast: function (data) {
          desc = data.desc;
          delete data.desc;
          this.$bvToast.toast(desc, data);
        }
      }
    });

    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    });

    $('.btn-outline-dark').popover({
      trigger: 'focus'
    });

    socket.on('show-toast', function (data) {
      toastNotification.newToast(data);
    });

    socket.on('show-chat-message', function (data) {
      chatBox.addMessage(data.sender, data.message, data.style);
    });

    socket.on("log-test", function (data) {
      console.log(data);
    });

    socket.on("card-setup", function (cardList) {
      handRenderCards.cardList = cardList;
    });

    socket.on('toggle-nav-el', function (data) {
      navbar.toggleNavElements(data.element, data.option);
    });

    $('#buttonChatCollapse').on('shown.bs.tab', function () {
      navbar.resetUnread();
    })
  </script>
</body>

</html>